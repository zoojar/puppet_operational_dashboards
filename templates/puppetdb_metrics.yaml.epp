<%- | Array[String] $urls, Enum['https', 'http'] $protocol, Integer[1] $http_timeout_seconds | -%>
<% if $protocol == 'https' { -%>
tls_cert: /etc/telegraf/puppet_cert.pem
tls_key: /etc/telegraf/puppet_key.pem
tls_ca: /etc/telegraf/puppet_ca.pem
<% } -%>
data_format: json_v2
headers:
  Content-type: application/json
body: >-
  [
    {"type":"read","name":"global_command-parse-time","mbean":"puppetlabs.puppetdb.mq:name=global.command-parse-time"},
    {"type":"read","name":"global_discarded","mbean":"puppetlabs.puppetdb.mq:name=global.discarded"},
    {"type":"read","name":"global_fatal","mbean":"puppetlabs.puppetdb.mq:name=global.fatal"},
    {"type":"read","name":"global_generate-retry-message-time","mbean":"puppetlabs.puppetdb.mq:name=global.generate-retry-message-time"},
    {"type":"read","name":"global_message-persistence-time","mbean":"puppetlabs.puppetdb.mq:name=global.message-persistence-time"},
    {"type":"read","name":"global_retried","mbean":"puppetlabs.puppetdb.mq:name=global.retried"},
    {"type":"read","name":"global_retry-counts","mbean":"puppetlabs.puppetdb.mq:name=global.retry-counts"},
    {"type":"read","name":"global_retry-persistence-time","mbean":"puppetlabs.puppetdb.mq:name=global.retry-persistence-time"},
    {"type":"read","name":"global_seen","mbean":"puppetlabs.puppetdb.mq:name=global.seen"},
    {"type":"read","name":"global_processed","mbean":"puppetlabs.puppetdb.mq:name=global.processed"},
    {"type":"read","name":"global_processing-time","mbean":"puppetlabs.puppetdb.mq:name=global.processing-time"},
    {"type":"read","name":"global_ignored","mbean":"puppetlabs.puppetdb.mq:name=global.ignored"},
    {"type":"read","name":"global_invalidated","mbean":"puppetlabs.puppetdb.mq:name=global.invalidated"},
    {"type":"read","name":"global_queue-time","mbean":"puppetlabs.puppetdb.mq:name=global.queue-time"},
    {"type":"read","name":"global_awaiting-retry","mbean":"puppetlabs.puppetdb.mq:name=global.awaiting-retry"},
    {"type":"read","name":"global_command-size","mbean":"puppetlabs.puppetdb.mq:name=global.size"},
    {"type":"read","name":"global_concurrent-depth","mbean":"puppetlabs.puppetdb.mq:name=global.concurrent-depth"},
    {"type":"read","name":"jetty-queuedthreadpool","mbean":"org.eclipse.jetty.util.thread:id=*,type=queuedthreadpool"},
    {"type":"read","name":"storage_add-edges","mbean":"puppetlabs.puppetdb.storage:name=add-edges"},
    {"type":"read","name":"storage_add-resources","mbean":"puppetlabs.puppetdb.storage:name=add-resources"},
    {"type":"read","name":"storage_catalog-hash","mbean":"puppetlabs.puppetdb.storage:name=catalog-hash"},
    {"type":"read","name":"storage_catalog-hash-match-time","mbean":"puppetlabs.puppetdb.storage:name=catalog-hash-match-time"},
    {"type":"read","name":"storage_catalog-hash-miss-time","mbean":"puppetlabs.puppetdb.storage:name=catalog-hash-miss-time"},
    {"type":"read","name":"storage_gc-catalogs-time","mbean":"puppetlabs.puppetdb.storage:name=gc-catalogs-time"},
    {"type":"read","name":"storage_gc-environments-time","mbean":"puppetlabs.puppetdb.storage:name=gc-environments-time"},
    {"type":"read","name":"storage_gc-fact-paths","mbean":"puppetlabs.puppetdb.storage:name=gc-fact-paths"},
    {"type":"read","name":"storage_gc-params-time","mbean":"puppetlabs.puppetdb.storage:name=gc-params-time"},
    {"type":"read","name":"storage_gc-report-statuses","mbean":"puppetlabs.puppetdb.storage:name=gc-report-statuses"},
    {"type":"read","name":"storage_gc-time","mbean":"puppetlabs.puppetdb.storage:name=gc-time"},
    {"type":"read","name":"storage_new-catalog-time","mbean":"puppetlabs.puppetdb.storage:name=new-catalog-time"},
    {"type":"read","name":"storage_new-catalogs","mbean":"puppetlabs.puppetdb.storage:name=new-catalogs"},
    {"type":"read","name":"storage_replace-catalog-time","mbean":"puppetlabs.puppetdb.storage:name=replace-catalog-time"},
    {"type":"read","name":"storage_replace-facts-time","mbean":"puppetlabs.puppetdb.storage:name=replace-facts-time"},
    {"type":"read","name":"storage_resource-hashes","mbean":"puppetlabs.puppetdb.storage:name=resource-hashes"},
    {"type":"read","name":"storage_store-report-time","mbean":"puppetlabs.puppetdb.storage:name=store-report-time"},
    {"type":"read","name":"PDBReadPool_pool_ActiveConnections","mbean":"puppetlabs.puppetdb.database:name=PDBReadPool.pool.ActiveConnections"},
    {"type":"read","name":"PDBReadPool_pool_IdleConnections","mbean":"puppetlabs.puppetdb.database:name=PDBReadPool.pool.IdleConnections"},
    {"type":"read","name":"PDBReadPool_pool_PendingConnections","mbean":"puppetlabs.puppetdb.database:name=PDBReadPool.pool.PendingConnections"},
    {"type":"read","name":"PDBReadPool_pool_TotalConnections","mbean":"puppetlabs.puppetdb.database:name=PDBReadPool.pool.TotalConnections"},
    {"type":"read","name":"PDBReadPool_pool_Usage","mbean":"puppetlabs.puppetdb.database:name=PDBReadPool.pool.Usage"},
    {"type":"read","name":"PDBReadPool_pool_Wait","mbean":"puppetlabs.puppetdb.database:name=PDBReadPool.pool.Wait"},
    {"type":"read","name":"PDBWritePool_pool_ActiveConnections","mbean":"puppetlabs.puppetdb.database:name=PDBWritePool.pool.ActiveConnections"},
    {"type":"read","name":"PDBWritePool_pool_IdleConnections","mbean":"puppetlabs.puppetdb.database:name=PDBWritePool.pool.IdleConnections"},
    {"type":"read","name":"PDBWritePool_pool_PendingConnections","mbean":"puppetlabs.puppetdb.database:name=PDBWritePool.pool.PendingConnections"},
    {"type":"read","name":"PDBWritePool_pool_TotalConnections","mbean":"puppetlabs.puppetdb.database:name=PDBWritePool.pool.TotalConnections"},
    {"type":"read","name":"PDBWritePool_pool_Usage","mbean":"puppetlabs.puppetdb.database:name=PDBWritePool.pool.Usage"},
    {"type":"read","name":"PDBWritePool_pool_Wait","mbean":"puppetlabs.puppetdb.database:name=PDBWritePool.pool.Wait"},
    {"type":"read","name":"mq_replace_catalog_retried","mbean":"puppetlabs.puppetdb.mq:name=replace catalog.9.retried"},
    {"type":"read","name":"mq_replace_catalog_retry-counts","mbean":"puppetlabs.puppetdb.mq:name=replace catalog.9.retry-counts"},
    {"type":"read","name":"mq_replace_catalog_size","mbean":"puppetlabs.puppetdb.mq:name=replace catalog.9.size"},
    {"type":"read","name":"mq_replace_catalog_processing-time","mbean":"puppetlabs.puppetdb.mq:name=replace catalog.9.processing-time"},
    {"type":"read","name":"mq_replace_catalog_processed","mbean":"puppetlabs.puppetdb.mq:name=replace catalog.9.processed"},
    {"type":"read","name":"mq_replace_catalog_inputs_retried","mbean":"puppetlabs.puppetdb.mq:name=replace catalog inputs.1.retried"},
    {"type":"read","name":"mq_replace_catalog_inputs_retry-counts","mbean":"puppetlabs.puppetdb.mq:name=replace catalog inputs.1.retry-counts"},
    {"type":"read","name":"mq_replace_catalog_inputs_ize","mbean":"puppetlabs.puppetdb.mq:name=replace catalog inputs.1.size"},
    {"type":"read","name":"mq_replace_catalog_inputs_processing-time","mbean":"puppetlabs.puppetdb.mq:name=replace catalog inputs.1.processing-time"},
    {"type":"read","name":"mq_replace_catalog_inputs_processed","mbean":"puppetlabs.puppetdb.mq:name=replace catalog inputs.1.processed"},
    {"type":"read","name":"mq_replace_facts_retried","mbean":"puppetlabs.puppetdb.mq:name=replace facts.5.retried"},
    {"type":"read","name":"mq_replace_facts_retry-counts","mbean":"puppetlabs.puppetdb.mq:name=replace facts.5.retry-counts"},
    {"type":"read","name":"mq_replace_facts_size","mbean":"puppetlabs.puppetdb.mq:name=replace facts.5.size"},
    {"type":"read","name":"mq_replace_facts_processing-time","mbean":"puppetlabs.puppetdb.mq:name=replace facts.5.processing-time"},
    {"type":"read","name":"mq_replace_facts_processed","mbean":"puppetlabs.puppetdb.mq:name=replace facts.5.processed"},
    {"type":"read","name":"mq_store_report_retried","mbean":"puppetlabs.puppetdb.mq:name=store report.8.retried"},
    {"type":"read","name":"mq_store_reports_retry-counts","mbean":"puppetlabs.puppetdb.mq:name=store report.8.retry-counts"},
    {"type":"read","name":"mq_store_reports_size","mbean":"puppetlabs.puppetdb.mq:name=store report.8.size"},
    {"type":"read","name":"mq_store_reports_processing-time","mbean":"puppetlabs.puppetdb.mq:name=store report.8.processing-time"},
    {"type":"read","name":"mq_store_reports_processed","mbean":"puppetlabs.puppetdb.mq:name=store report.8.processed"},
    {"type":"read","name":"mq_deactivate_node_processed","mbean":"puppetlabs.puppetdb.mq:name=deactivate node.3.processed"},
    {"type":"read","name":"mq_deactivate_node_processing-time","mbean":"puppetlabs.puppetdb.mq:name=deactivate node.3.processing-time"},
    {"type":"read","name":"ha_seconds-since-last-successful-sync","mbean":"puppetlabs.puppetdb.ha:name=seconds-since-last-successful-sync"},
    {"type":"read","name":"ha_failed-request-counter","mbean":"puppetlabs.puppetdb.ha:name=failed-request-counter"},
    {"type":"read","name":"ha_sync-duration","mbean":"puppetlabs.puppetdb.ha:name=sync-duration"},
    {"type":"read","name":"ha_catalogs-sync-duration","mbean":"puppetlabs.puppetdb.ha:name=catalogs-sync-duration"},
    {"type":"read","name":"ha_reports-sync-duration","mbean":"puppetlabs.puppetdb.ha:name=reports-sync-duration"},
    {"type":"read","name":"ha_factsets-sync-duration","mbean":"puppetlabs.puppetdb.ha:name=factsets-sync-duration"},
    {"type":"read","name":"ha_nodes-sync-duration","mbean":"puppetlabs.puppetdb.ha:name=nodes-sync-duration"},
    {"type":"read","name":"ha_record-transfer-duration","mbean":"puppetlabs.puppetdb.ha:name=record-transfer-duration"}
  ]
timeout: <%= $http_timeout_seconds %>s
method: POST
urls: <%= $urls %>
json_v2:
  - measurement_name: puppetdb
    object:
      - path: '@this'
        tags:
          - request_mbean
        excluded_keys:
          - value_RateUnit
          - value_DurationUnit
          - request_type
          - status
          - timestamp
          - error
          - error_type
        disable_prepend_keys: true
